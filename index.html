<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GitHub Folder Auto Downloader</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { display: none; } /* hide UI for direct download */
  </style>
</head>
<body>
<script>
async function fetchFiles(owner, repo, path) {
  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  const resp = await fetch(apiUrl);
  const data = await resp.json();
  let files = [];
  for (const item of data) {
    if (item.type === "file") {
      files.push({ path: item.path, download_url: item.download_url });
    } else if (item.type === "dir") {
      const sub = await fetchFiles(owner, repo, item.path);
      files = files.concat(sub);
    }
  }
  return files;
}

async function downloadFolder(folderUrl) {
  const match = folderUrl.match(/github\.com\/([^/]+)\/([^/]+)\/tree\/([^/]+)\/(.+)/);
  if (!match) {
    alert("Invalid GitHub folder URL");
    return;
  }
  const [_, owner, repo, branch, path] = match;

  const files = await fetchFiles(owner, repo, path);
  const zip = new JSZip();

  for (const file of files) {
    const resp = await fetch(file.download_url);
    const blob = await resp.blob();
    zip.file(file.path.replace(`${path}/`, ""), blob);
  }

  const content = await zip.generateAsync({ type: "blob" });
  saveAs(content, `${path.split("/").pop()}.zip`);
}

// Auto-run if ?url=... is present
window.addEventListener("load", () => {
  const params = new URLSearchParams(window.location.search);
  const folderUrl = params.get("url");
  if (folderUrl) {
    downloadFolder(folderUrl);
  } else {
    alert("Please provide a folder URL using ?url=");
  }
});
</script>
</body>
</html>
